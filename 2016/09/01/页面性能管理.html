<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>页面性能管理 | ntscshen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="网页生成的过程、大致分成五步

第一步到第三幕都非常快( 一刹那 )

“生成布局” - flow - layout(布局) - Render Tree( 渲染树 )
“绘制” - paint
flow + paint = render(渲染)


重排和重绘
重绘：元素外观改变所触发的浏览器行为(visibility\outline\背景色)
重排：渲染树重新计算


“重绘”不一定”重排”
“">
<meta property="og:type" content="article">
<meta property="og:title" content="页面性能管理">
<meta property="og:url" content="http://ntscshen.com/2016/09/01/页面性能管理.html">
<meta property="og:site_name" content="ntscshen">
<meta property="og:description" content="网页生成的过程、大致分成五步

第一步到第三幕都非常快( 一刹那 )

“生成布局” - flow - layout(布局) - Render Tree( 渲染树 )
“绘制” - paint
flow + paint = render(渲染)


重排和重绘
重绘：元素外观改变所触发的浏览器行为(visibility\outline\背景色)
重排：渲染树重新计算


“重绘”不一定”重排”
“">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091502.png">
<meta property="og:updated_time" content="2016-11-28T06:05:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="页面性能管理">
<meta name="twitter:description" content="网页生成的过程、大致分成五步

第一步到第三幕都非常快( 一刹那 )

“生成布局” - flow - layout(布局) - Render Tree( 渲染树 )
“绘制” - paint
flow + paint = render(渲染)


重排和重绘
重绘：元素外观改变所触发的浏览器行为(visibility\outline\背景色)
重排：渲染树重新计算


“重绘”不一定”重排”
“">
<meta name="twitter:image" content="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091502.png">
  
    <link rel="alternate" href="/atom.xml" title="ntscshen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ntscshen</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">日光之下並無新事 | Day Coding</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://ntscshen.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-页面性能管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/01/页面性能管理.html" class="article-date">
  <time datetime="2016-09-01T01:08:57.000Z" itemprop="datePublished">2016-09-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/jQuery/">jQuery</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      页面性能管理
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="网页生成的过程、大致分成五步"><a href="#网页生成的过程、大致分成五步" class="headerlink" title="网页生成的过程、大致分成五步"></a>网页生成的过程、大致分成五步</h3><p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091502.png" alt=""></p>
<blockquote>
<p>第一步到第三幕都非常快( 一刹那 )</p>
<ul>
<li>“生成布局” - flow - layout(布局) - Render Tree( 渲染树 )</li>
<li>“绘制” - paint</li>
<li>flow + paint = render(渲染)</li>
</ul>
</blockquote>
<h3 id="重排和重绘"><a href="#重排和重绘" class="headerlink" title="重排和重绘"></a>重排和重绘</h3><ul>
<li>重绘：元素外观改变所触发的浏览器行为(visibility\outline\背景色)</li>
<li>重排：渲染树重新计算</li>
</ul>
<blockquote>
<p>“重绘”不一定”重排”</p>
<p>“重排”必定”重绘”</p>
</blockquote>
<p>从性能角度考虑</p>
<ul>
<li>经量不把 <code>读操作</code> 和  <code>写操作</code> 在一个里面</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">div.style.left = div.offsetLeft + <span class="number">10</span> + <span class="string">"px"</span>;</div><div class="line"><span class="comment">// Good</span></div><div class="line"><span class="keyword">var</span> left = div.offsetLeft;</div><div class="line">div.style.left = left + <span class="number">10</span> + <span class="string">"px"</span>;</div></pre></td></tr></table></figure>
<h2 id="一般规则如下"><a href="#一般规则如下" class="headerlink" title="一般规则如下"></a>一般规则如下</h2><ul>
<li>样式表越简单、重排和重绘就会越快</li>
<li>重排和重绘的DOM元素层级越高、成本就越高</li>
<li>table元素的重排和重绘成本、高于div元素</li>
</ul>
<h2 id="提高性能的技巧"><a href="#提高性能的技巧" class="headerlink" title="提高性能的技巧"></a>提高性能的技巧</h2><ol>
<li><p>读操作和写操作、应该放在一起( 不要在两个读操作之间、加入一个写操作 )</p>
</li>
<li><p>若某个样式是通过重排得到的、把结果缓存下来、避免下一次用到的时候、浏览器重排</p>
<ol>
<li>在需要经常获取那些引起浏览器重排的属性值时，要缓存到变量。</li>
</ol>
</li>
<li><p>不要在JS里一条条的修改样式、要通过改变class或者csstext属性、一次性地改变样式</p>
</li>
<li><p>将元素设置<code>display: none</code>( 需要一次重排和重绘 )、然后对这个几点进行N+次操作、最后再回复显示( 需要一次重排和重绘 )、这样、使用<code>两次</code>重新渲染、取代可能的N+次的重新渲染</p>
</li>
<li><p>position属性为absolute或fixed的元素时候、重排的开销比较小、因为不用考虑它对其他元素的影响</p>
</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad   </span></div><div class="line"><span class="keyword">var</span> top = <span class="number">10</span>;   </div><div class="line">ele.style.left = left + <span class="string">"px"</span>;   </div><div class="line">ele.style.top = top + <span class="string">"px"</span>;   <span class="comment">// Good   </span></div><div class="line"><span class="keyword">var</span> top = <span class="number">10</span>,left = <span class="number">10</span>;   </div><div class="line">$(<span class="string">'ele'</span>).css(&#123;<span class="attr">left</span>: left,<span class="attr">top</span>: top&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="css的效率"><a href="#css的效率" class="headerlink" title="css的效率"></a>css的效率</h2><blockquote>
<p>浏览器读取CSS选择器有一个很重要的原则，它们从右到左读取。这意味这像 <code>ul &gt; li a[title=&quot;home&quot;]</code>这样的选择器， <code>a[title=&quot;home&quot;]</code> 将是最先被读取的。</p>
</blockquote>
<ul>
<li>ID是唯一的、所以不需要任何的标签进行修饰、这样只会让效率更低<code>ul#main{}</code></li>
<li><strong>没有什么比用后代选择器更糟糕的做法了</strong> 后代选择器是css选择器里最昂贵的选择器</li>
</ul>
<h2 id="总结的优化技巧"><a href="#总结的优化技巧" class="headerlink" title="总结的优化技巧"></a>总结的优化技巧</h2><h4 id="CSS优化"><a href="#CSS优化" class="headerlink" title="CSS优化"></a>CSS优化</h4><ul>
<li>CSS尽量避免使用后代选择器 - 使用子代选择器代替<code>没有比后代选择器跟糟糕的</code></li>
<li>在书写CSS时、使用类选择器”代替”元素选择器<code>类选择器获取速度优于元素选择器</code></li>
<li>样式表越简单、嵌套层级越小( 重排和重绘就会越快 ) <code>sass书写不大于三层</code></li>
</ul>
<h4 id="jQuery优化"><a href="#jQuery优化" class="headerlink" title="jQuery优化"></a>jQuery优化</h4><ul>
<li><p>选择器优化</p>
<ul>
<li>尽可能使用ID选择器( 唯一的、最快的 )，因为jQuery源码中调用的是<code>document.getElementById()</code>、不要与其他选择器混搭</li>
<li>class选择器次之<code>调用原生getElementByClassName()方法</code>、指定类选择器的上下文、以缩小选择范围(默认：document)<code>$(&#39;.class&#39;,&#39;#div1&#39;)</code>;</li>
<li>多级查找中、选择器的子类越详细越好<code>$(&quot;.data li.li1&quot;)</code> </li>
<li>$parent.find(‘p.child’) 最快查找子元素的方法<code>find()会调用原生的 getElementByTagName方法</code></li>
<li>经可能的缓存<code>(缓存比不缓存快了2-3倍)</code> <code>为什么要缓存得到的变量？就是减少访问DOM接口</code></li>
<li>使用链式写法、jQuery会自动缓存每一步的结果、链式比不链式写法快了25%左右</li>
</ul>
</li>
<li><p>DOM优化</p>
<ul>
<li><p>如果对一个DOM进行大量处理操作、使用.detach()方法、取出 - 处理 - 插入、使用.detach()方法比不使用时，快了60%。<code>.detach(分离)</code></p>
</li>
<li><p><code>.detach()</code>移除被选元素，包括所有文本和子节点。这个方法会保留 jQuery 对象中的匹配的元素，因而可以在将来再使用这些匹配的元素。会保留所有绑定的事件、附加的数据。<code>主要为了处理元素的大量DOM操作而生</code></p>
</li>
<li><p>改动DOM结构、先把它们合并，然后再一次性插入</p>
</li>
<li><p>不要使用匿名函数来用作事件处理、这样不利于调试、测试、维护和服用<code>$(&quot;#btn&quot;).on(&#39;click&#39;,&#39;a&#39;,myClick);function myClick(){...}</code></p>
</li>
<li><p>在DOM元素上存储数据</p>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ele = $(<span class="string">'#ele'</span>);</div><div class="line">ele.data(key,value);</div><div class="line"><span class="comment">// 修改</span></div><div class="line"><span class="keyword">var</span> ele = $(<span class="string">'#ele'</span>);</div><div class="line">$.data(ele[<span class="number">0</span>],key,value);</div><div class="line"><span class="comment">// 因为elem.data()方法是定义在jQuery函数的prototype对象上面的，而$.data()方法是定义jQuery函数上面的，调用的时候不从复杂的jQuery对象上调用</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>如果可能的话使用自己的事件命名空间、这样方便地取消绑定而不影响其他的DOM元素事件绑定<code>$(&quot;#myClick&quot;).on(&quot;click.ntscshen&quot;,&quot;a&quot;,myEventHandler);$(&quot;#myClick&quot;).off(&quot;click.ntscshen&quot;)</code></p>
</li>
<li><p>不要处理不存在的元素<code>if($mySelection.length){...}</code></p>
</li>
<li><p>当某个事件后、如果要连续执行多个操作<code>使用自定义事件并使用自执行事件</code></p>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">shen</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  $.trigger(<span class="string">'yang'</span>);</div><div class="line">&#125;</div><div class="line">$(<span class="built_in">document</span>).on(<span class="string">'yang'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  one();</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="其他的优化方案"><a href="#其他的优化方案" class="headerlink" title="其他的优化方案"></a>其他的优化方案</h4><ul>
<li>在JS内会用添加类名的方式修改”样式”属性<code>不要使用jquery.CSS({方法})</code>、使用添加类名的方式<code>$(&quot;#click&quot;).addClass(&quot;error&quot;);</code></li>
</ul>
<ul>
<li>使用事件委托进行处理的方式<code>就近原则</code></li>
<li>在注重性能的地方、请使用原生的Javascript代码</li>
<li>当需要大量的DOM操作时、先隐藏在内存中操作、在显示<code>只触发两次重排和重绘操作</code></li>
<li>定位元素的开销较小、不用考虑对其他元素的影响</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ntscshen.com/2016/09/01/页面性能管理.html" data-id="ciw2vld9r0010rct1k8sf6s0n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jQuery/">jQuery</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/06/设计模式之 - 单体模式.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          设计模式之 - 单体模式
        
      </div>
    </a>
  
  
    <a href="/2016/08/31/BFC.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BFC</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/">ES6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jQuery/">jQuery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具使用/">工具使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/布局/">布局</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/需求/">需求</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tool/">Tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/需求/">需求</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Tool/" style="font-size: 16.67px;">Tool</a> <a href="/tags/css/" style="font-size: 20px;">css</a> <a href="/tags/jQuery/" style="font-size: 13.33px;">jQuery</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/需求/" style="font-size: 10px;">需求</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/29/baidu_verify_RFKiER6cMC.html">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/11/28/需求文档.html">需求文档</a>
          </li>
        
          <li>
            <a href="/2016/11/19/Mac上网络抓包Charles.html">Mac上网络抓包Charles</a>
          </li>
        
          <li>
            <a href="/2016/11/18/页面操作iFrame的Dom.html">页面操作iFrame的Dom</a>
          </li>
        
          <li>
            <a href="/2016/10/08/Atom编辑器的使用技巧.html">Atom编辑器的使用技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 ntscshen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>